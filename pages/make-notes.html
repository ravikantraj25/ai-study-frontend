<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Make Notes â€” AI Study</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="../styles.css">
<style>
  .page-wrapper { max-width:920px; margin:36px auto; }
  .card{ padding:18px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow:0 10px 30px rgba(2,6,23,0.55); }
  textarea { width:100%; min-height:200px; padding:14px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:inherit; resize:vertical }
  .btn-primary{ padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,#7f5af0,#5eead4);color:#021; font-weight:700; cursor:pointer }
  .loader{ width:16px;height:16px;border-radius:50%; border:3px solid rgba(255,255,255,0.1); border-top-color:#5eead4; animation:spin 900ms linear infinite; display:inline-block }
  .hidden{ display:none }
  .result-card{ margin-top:18px; padding:12px; border-radius:12px; background: rgba(255,255,255,0.02) }
  @keyframes spin{ to{ transform:rotate(360deg) } }
</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
  <div class="brand">AI Study</div>
  <a href="../index.html">Home</a>
  <a href="summarize.html">Summarize PDF</a>
  <a href="make-notes.html" class="active">Make Notes</a>
  <a href="mcq.html">Make MCQ</a>
  <a href="explain.html">Explain</a>
  <a href="qna.html">QnA</a>
  <a href="notes.html">Notes History</a>
  <div class="spacer"></div>
  <a href="profile.html">Update Profile</a>
  <a href="delete-account.html">Delete Account</a>
</aside>

<main class="content-with-sidebar">
  <div class="page-wrapper container">
    <h1 class="h-gradient">Make Notes</h1>
    <p class="center mt-8">Paste text or your summary and let AI convert it into neat, structured notes.</p>

    <div class="card mt-18">
      <textarea id="notes-text" placeholder="Paste text or summary here..."></textarea>
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
        <button id="notes-submit" class="btn-primary">Create Notes</button>
        <span id="notes-loader" class="loader hidden" aria-hidden="true"></span>
        <div style="flex:1"></div>
        <small style="opacity:0.7">Notes are saved to your account (if logged in).</small>
      </div>
    </div>

    <div id="notes-result" class="result-card"></div>
  </div>
</main>
<script src="../config.js"></script>
<script>
(() => {
  const API = window.API_BASE || "";
  const tokenKey = "ai_study_token";
  const btn = document.getElementById("notes-submit");
  const loader = document.getElementById("notes-loader");
  const out = document.getElementById("notes-result");
  const textEl = document.getElementById("notes-text");

  function show(l){ l.classList.remove("hidden"); }
  function hide(l){ l.classList.add("hidden"); }
  function esc(t){ return String(t||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }

  btn.addEventListener("click", async ()=>{
    out.innerHTML = "";
    const text = (textEl.value || "").trim();
    if(!text){ out.innerHTML = "<p style='color:#ff4d6d'>Enter text to create notes.</p>"; return; }
    show(loader); btn.disabled = true;

    try {
      const headers = { "Content-Type": "application/json" };
      const token = localStorage.getItem(tokenKey);
      if(token) headers["Authorization"] = "Bearer " + token;

      const resp = await fetch((API||"") + "/make-notes", { method:"POST", headers, body: JSON.stringify({ text }) });
      const ct = (resp.headers.get("content-type") || "").toLowerCase();

      let data;
      if(ct.includes("json")) {
        data = await resp.json().catch(()=> ({ notes: resp.text() }));
      } else {
        data = { notes: await resp.text() };
      }

      const notes = data.notes || data.note || JSON.stringify(data, null, 2);
      out.innerHTML = "<h3>Generated Notes</h3><pre style='white-space:pre-wrap;line-height:1.6'>"+esc(notes)+"</pre>";

    } catch (err) {
      out.innerHTML = "<p style='color:#ff4d6d'>Error: "+esc(err.message||err)+"</p>";
    } finally {
      hide(loader); btn.disabled = false;
    }
  });
})();
</script>
</body>
</html>
