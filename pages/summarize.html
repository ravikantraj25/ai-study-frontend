<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Summarize PDF â€” AI Study</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="../styles.css">
<style>
  /* premium small-page overrides */
  .page-wrapper { max-width:960px; margin:32px auto; }
  .card { background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border-radius:16px; padding:20px; box-shadow:0 6px 20px rgba(2,6,23,0.5); }
  .h-gradient { background: linear-gradient(90deg,#7f5af0,#5eead4); -webkit-background-clip:text; color:transparent; font-size:28px; }
  .btn-primary{ padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,#7f5af0,#5eead4);color:#021; font-weight:700; cursor:pointer }
  .input-file { width:100%; padding:12px; border-radius:10px; background:transparent; border:1px dashed rgba(255,255,255,0.06); color:inherit }
  .loader{ width:18px;height:18px;border-radius:50%; border:3px solid rgba(255,255,255,0.12); border-top-color: #7f5af0; display:inline-block; vertical-align:middle; animation:spin 900ms linear infinite }
  .hidden{ display:none }
  .result-card{ margin-top:18px; padding:14px; border-radius:12px; background: rgba(255,255,255,0.02); min-height:80px }
  @keyframes spin{ to{ transform:rotate(360deg) } }
</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
  <div class="brand">AI Study</div>
  <a href="../index.html">Home</a>
  <a href="summarize.html" class="active">Summarize PDF</a>
  <a href="make-notes.html">Make Notes</a>
  <a href="mcq.html">Make MCQ</a>
  <a href="explain.html">Explain</a>
  <a href="qna.html">QnA</a>
  <a href="notes.html">Notes History</a>
  <div class="spacer"></div>
  <a href="profile.html">Update Profile</a>
  <a href="delete-account.html">Delete Account</a>
</aside>

<main class="content-with-sidebar">
  <div class="page-wrapper container">
    <h1 class="h-gradient">Summarize PDF</h1>
    <p class="center mt-8">Upload a PDF and get a concise AI-generated summary and key points.</p>

    <div class="card mt-18">
      <input id="pdfFile" type="file" accept="application/pdf" class="input-file" />
      <div style="display:flex;gap:12px;align-items:center;margin-top:14px">
        <button id="summarize-btn" class="btn-primary">Generate Summary</button>
        <span id="summarize-loader" class="loader hidden" aria-hidden="true"></span>
        <div style="flex:1"></div>
        <small style="opacity:0.7">Max file size: as per backend</small>
      </div>
    </div>

    <div id="summarize-result" class="result-card"></div>
  </div>
</main>
<script src="../config.js"></script>

<script>
(async ()=>{
  const API = window.API_BASE || "";
  const tokenKey = "ai_study_token";

  const fileEl = document.getElementById("pdfFile");
  const btn = document.getElementById("summarize-btn");
  const loader = document.getElementById("summarize-loader");
  const out = document.getElementById("summarize-result");

  function show(l){ l.classList.remove("hidden"); }
  function hide(l){ l.classList.add("hidden"); }
  function esc(t){ return String(t||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }

  btn.addEventListener("click", async ()=>{
    out.innerHTML = "";

    if(!fileEl.files?.length){
      out.innerHTML = "<p style='color:#ff4d6d'>Please choose a PDF file.</p>";
      return;
    }

    show(loader);
    btn.disabled = true;

    try {
      const fd = new FormData();
      fd.append("file", fileEl.files[0]);

      const headers = {};
      const t = localStorage.getItem(tokenKey);
      if(t) headers["Authorization"] = "Bearer " + t;

      const resp = await fetch(API + "/summarize", {
        method:"POST",
        headers,
        body: fd
      });

      const ct = (resp.headers.get("content-type") || "").toLowerCase();
      let data;

      if(ct.includes("json")){
        data = await resp.json();
      } else {
        data = { summary: await resp.text() };
      }

      const text = data.summary || "(No summary generated)";

      out.innerHTML = `
        <h3>Summary</h3>
        <div style="margin-top:10px; line-height:1.6; white-space:pre-wrap;">
          ${esc(text)}
        </div>
      `;
    }
    catch(err){
      out.innerHTML = "<p style='color:#ff4d6d'>Error: "+esc(err.message)+"</p>";
    }
    finally{
      hide(loader);
      btn.disabled = false;
    }
  });
})();
</script>

</body>
</html>
