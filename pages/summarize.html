<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Summarize PDF â€” AI Study</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="../styles.css">
</head>
<body>

<!-- sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="brand">AI Study</div>
  <a href="../index.html">Home</a>
  <a href="summarize.html" class="active">Summarize PDF</a>
  <a href="make-notes.html">Make Notes</a>
  <a href="mcq.html">Make MCQ</a>
  <a href="explain.html">Explain</a>
  <a href="qna.html">QnA</a>
  <a href="notes.html">Notes History</a>
  <div class="spacer"></div>
  <a href="profile.html">Update Profile</a>
  <a href="delete-account.html">Delete Account</a>
</aside>

<!-- page content -->
<main class="content-with-sidebar">
  <div class="page-wrapper container">
    <h1 class="h-gradient">Summarize PDF</h1>
    <p class="center mt-18">Upload a PDF and get a smart AI summary with key-points and suggested MCQs.</p>

    <div class="upload-card mt-18 card">
      <input id="pdfFile" type="file" accept="application/pdf" class="input-file">
      <div class="mt-18">
        <button class="btn-primary" onclick="summarizePDF()">Generate Summary</button>
        <span id="summarize-loader" class="loader hidden"></span>
      </div>
    </div>

    <div id="summarize-result" class="result-card"></div>
  </div>
</main>

<script src="../app.js"></script>
<script>
  // hooking function used earlier - ensure summarizePDF exists (app.js may already include)
  async function summarizePDF(){
    const fileInput = document.getElementById('pdfFile');
    const loader = document.getElementById('summarize-loader');
    const out = document.getElementById('summarize-result');
    out.innerHTML = '';
    if (!fileInput.files || fileInput.files.length===0){ out.innerText='Choose a PDF file.'; return; }
    loader.classList.remove('hidden');
    try {
      const form = new FormData();
      form.append('file', fileInput.files[0]);
      const token = localStorage.getItem('ai_study_token');
      const res = await fetch((window.API_BASE || '') + '/summarize', {
        method:'POST',
        headers: token ? { 'Authorization': 'Bearer ' + token } : {},
        body: form
      });
      const json = await res.json();
      // format response intelligently
      let text = '';
      if (Array.isArray(json)) text = json.map(r=> r.summary || JSON.stringify(r)).join('\n\n');
      else text = json.summary || json.text || JSON.stringify(json, null, 2);
      out.innerHTML = '<h3>Summary</h3><p>' + (String(text).replace(/\n/g, '<br>')) + '</p>';
    } catch (err) {
      out.innerText = 'Error: ' + (err.message || err);
    } finally { loader.classList.add('hidden'); }
  }
</script>
</body>
</html>
