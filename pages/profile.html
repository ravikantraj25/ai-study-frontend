<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Profile ‚Äî AI Study</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../styles.css">

<style>
/* ---------- REUSING YOUR PREMIUM THEME VARIABLES ---------- */
:root {
    --bg-color: #050507;
    --text-main: #ffffff;
    --text-muted: #a1a1aa;
    --primary-gradient: linear-gradient(135deg, #6366f1, #3b82f6);
    --card-bg: rgba(255, 255, 255, 0.03);
    --card-border: rgba(255, 255, 255, 0.08);
    --card-hover-bg: rgba(255, 255, 255, 0.06);
    --shadow-color: rgba(0, 0, 0, 0.5);
    --danger-bg: rgba(239, 68, 68, 0.1);
    --danger-text: #ef4444;
}

[data-theme="light"] {
    --bg-color: #f8fafc;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --card-bg: rgba(255, 255, 255, 0.8);
    --card-border: rgba(0, 0, 0, 0.06);
    --card-hover-bg: rgba(255, 255, 255, 0.95);
    --shadow-color: rgba(148, 163, 184, 0.15);
}

/* ---------- PAGE STYLES ---------- */
body {
    background: var(--bg-color);
    color: var(--text-main);
    font-family: "Inter", sans-serif;
    margin: 0;
    overflow-x: hidden;
}

.page-wrapper { max-width: 850px; margin: 40px auto; padding: 0 24px; animation: fadeUp 0.6s ease-out; }

/* 1. Header Section */
.profile-header {
    display: flex;
    align-items: center;
    gap: 30px;
    margin-bottom: 40px;
    background: var(--card-bg);
    padding: 40px;
    border-radius: 24px;
    border: 1px solid var(--card-border);
    backdrop-filter: blur(12px);
    box-shadow: 0 20px 50px -10px var(--shadow-color);
}

.avatar-wrapper {
    position: relative;
}

.avatar {
    width: 100px; height: 100px;
    border-radius: 50%;
    background: var(--primary-gradient);
    display: flex; align-items: center; justify-content: center;
    font-size: 40px; font-weight: 800; color: #fff;
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    border: 4px solid var(--bg-color); /* Creates a cutout effect */
}

.user-status {
    position: absolute; bottom: 5px; right: 5px;
    width: 18px; height: 18px;
    background: #10b981; border: 3px solid var(--bg-color);
    border-radius: 50%;
}

.info { flex: 1; }
.info h1 { margin: 0 0 8px 0; font-size: 2.2rem; letter-spacing: -0.5px; font-weight: 700; }
.info-meta { display: flex; flex-direction: column; gap: 4px; }
.meta-item { display: flex; align-items: center; gap: 8px; color: var(--text-muted); font-size: 0.95rem; }
.meta-icon { opacity: 0.7; width: 16px; text-align: center; }

/* 2. Stats Grid (Optional but looks great) */
.stats-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px;
}
.stat-card {
    background: var(--card-bg); border: 1px solid var(--card-border);
    padding: 20px; border-radius: 16px; text-align: center;
    transition: 0.3s;
}
.stat-card:hover { transform: translateY(-3px); background: var(--card-hover-bg); }
.stat-val { font-size: 1.8rem; font-weight: 700; color: var(--text-main); }
.stat-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 5px; }


/* 3. Settings List */
.section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 20px; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
.section-title::before { content:''; width:4px; height:24px; background: #6366f1; border-radius: 2px; }

.settings-list { display: flex; flex-direction: column; gap: 16px; }

.action-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    padding: 24px;
    border-radius: 16px;
    display: flex; justify-content: space-between; align-items: center;
    transition: 0.2s ease;
}

.action-card:hover { background: var(--card-hover-bg); transform: translateX(5px); }

.action-info h3 { margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 600; }
.action-info p { margin: 0; color: var(--text-muted); font-size: 0.9rem; }

/* Buttons */
.btn-primary {
    padding: 10px 24px; border-radius: 10px; border: none;
    background: var(--primary-gradient); color: #fff;
    font-weight: 600; cursor: pointer; transition: 0.2s;
}
.btn-primary:hover { opacity: 0.9; transform: scale(1.02); }

.btn-secondary {
    padding: 10px 24px; border-radius: 10px; border: 1px solid var(--card-border);
    background: transparent; color: var(--text-main);
    font-weight: 600; cursor: pointer; transition: 0.2s;
}
.btn-secondary:hover { background: rgba(255,255,255,0.05); }

.btn-danger {
    padding: 10px 24px; border-radius: 10px;
    background: var(--danger-bg); color: var(--danger-text);
    border: 1px solid rgba(239, 68, 68, 0.2);
    font-weight: 600; cursor: pointer; transition: 0.2s;
}
.btn-danger:hover { background: #ef4444; color: #fff; }

@keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* Sidebar fix */
.sidebar { position: fixed; height: 100vh; top: 0; left: 0; width: 250px; border-right: 1px solid var(--card-border); background: var(--bg-color); z-index: 10; }
.content-with-sidebar { margin-left: 250px; padding: 20px; }
</style>
</head>

<body>

<aside class="sidebar" id="sidebar">
    <div class="brand" style="padding:24px; font-size:22px; font-weight:800; background:var(--primary-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">AI Study</div>
    <a href="../index.html">Home</a>
    <a href="summarize.html">Summarize PDF</a>
    <a href="make-notes.html">Make Notes</a>
    <a href="mcq.html">Make MCQ</a>
    <a href="explain.html">Explain</a>
    <a href="qna.html">QnA</a>
    <a href="notes.html">History</a>
    <div class="spacer" style="height:40px"></div>
    <a href="profile.html" class="active">Profile</a>
    <a href="update-profile.html">Update Profile</a>
</aside>

<main class="content-with-sidebar">
    <div class="page-wrapper">
        
        <div class="profile-header">
            <div class="avatar-wrapper">
                <div class="avatar" id="avatar">U</div>
                <div class="user-status"></div>
            </div>
            <div class="info">
                <h1 id="user-name">Loading...</h1>
                <div class="info-meta">
                    <div class="meta-item">
                        <span class="meta-icon">üìß</span> <span id="user-email">...</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">üì±</span> <span id="user-mobile">No mobile added</span>
                    </div>
                </div>
            </div>
            <button class="btn-primary" onclick="location.href='update-profile.html'">Edit Profile</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-val" id="stat-notes">0</div>
                <div class="stat-label">Notes Created</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="stat-mcqs">0</div>
                <div class="stat-label">Quizzes Taken</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="stat-days">1</div>
                <div class="stat-label">Day Streak</div>
            </div>
        </div>

        <div class="section-title">Account Settings</div>

        <div class="settings-list">
            
            <div class="action-card">
                <div class="action-info">
                    <h3>Security</h3>
                    <p>Change your password or security settings.</p>
                </div>
                <button class="btn-secondary" style="opacity:0.6; cursor:not-allowed;">Coming Soon</button>
            </div>

            <div class="action-card">
                <div class="action-info">
                    <h3>Sign Out</h3>
                    <p>Log out from this device securely.</p>
                </div>
                <button class="btn-secondary" id="logout-btn">Logout</button>
            </div>

            <div class="action-card" style="border-color: rgba(239,68,68,0.3); background: rgba(239,68,68,0.03);">
                <div class="action-info">
                    <h3 style="color:var(--danger-text)">Delete Account</h3>
                    <p>Permanently remove all data and history.</p>
                </div>
                <button class="btn-danger" id="delete-btn">Delete</button>
            </div>
        </div>

    </div>
</main>

<script src="../config.js"></script>
<script>
    const token = localStorage.getItem("ai_study_token");
    if(!token) window.location.href = "login.html";

    // Load Profile
    async function loadData() {
        try {
            const res = await fetch(`${window.API_BASE}/auth/me`, {
                headers: { "Authorization": `Bearer ${token}` }
            });
            if(!res.ok) throw new Error("Unauthorized");
            
            const data = await res.json();
            const user = data.user;

            document.getElementById("user-name").innerText = user.name;
            document.getElementById("user-email").innerText = user.email;
            document.getElementById("user-mobile").innerText = user.mobile || "No mobile added";
            document.getElementById("avatar").innerText = user.name.charAt(0).toUpperCase();

            // Mock Stats (You can wire this up to backend later)
            document.getElementById("stat-notes").innerText = Math.floor(Math.random() * 10) + 2; 
            document.getElementById("stat-mcqs").innerText = Math.floor(Math.random() * 5);

        } catch (e) {
            localStorage.removeItem("ai_study_token");
            window.location.href = "login.html";
        }
    }

    // Logout
    document.getElementById("logout-btn").addEventListener("click", () => {
        localStorage.removeItem("ai_study_token");
        window.location.href = "../index.html";
    });

    // Delete Account
    document.getElementById("delete-btn").addEventListener("click", async () => {
        if(confirm("‚ö†Ô∏è DANGER ZONE: Are you sure? This will delete all your notes, history, and account data permanently.")) {
            try {
                const res = await fetch(`${window.API_BASE}/auth/me`, {
                    method: "DELETE",
                    headers: { "Authorization": `Bearer ${token}` }
                });
                
                if(res.ok) {
                    alert("Account deleted successfully.");
                    localStorage.removeItem("ai_study_token");
                    window.location.href = "../index.html";
                } else {
                    alert("Failed to delete account. Please try again.");
                }
            } catch(e) {
                alert("Network error.");
            }
        }
    });

    loadData();
</script>
</body>
</html>