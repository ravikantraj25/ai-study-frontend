<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Explain Topic â€” AI Study</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="../styles.css">
<style>
  .page-wrapper { max-width:920px; margin:36px auto; }
  .card{ padding:18px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow:0 10px 30px rgba(2,6,23,0.55); }
  input[type="text"]{ width:100%; padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06); color:inherit }
  .btn-primary{ padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,#7f5af0,#5eead4);color:#021; font-weight:700; cursor:pointer }
  .loader{ width:16px;height:16px;border-radius:50%; border:3px solid rgba(255,255,255,0.08); border-top-color:#5eead4; animation:spin 900ms linear infinite; display:inline-block }
  .hidden{ display:none }
  .explain-block{ margin-bottom:14px; padding:10px; border-radius:10px; background:rgba(0,0,0,0.02) }
  @keyframes spin{ to{ transform:rotate(360deg) } }
</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
  <div class="brand">AI Study</div>
  <a href="../index.html">Home</a>
  <a href="summarize.html">Summarize PDF</a>
  <a href="make-notes.html">Make Notes</a>
  <a href="mcq.html">Make MCQ</a>
  <a href="explain.html" class="active">Explain</a>
  <a href="qna.html">QnA</a>
  <a href="notes.html">Notes History</a>
  <div class="spacer"></div>
  <a href="profile.html">Update Profile</a>
  <a href="delete-account.html">Delete Account</a>
</aside>

<main class="content-with-sidebar">
  <div class="page-wrapper container">
    <h1 class="h-gradient">Explain Topic</h1>
    <p class="center mt-8">Get structured explanations with bullets, examples and FAQs.</p>

    <div class="card mt-18">
      <input id="explain-topic" type="text" placeholder="Enter topic (e.g. Statically typed vs Dynamically typed languages)" />
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
        <button id="explain-btn" class="btn-primary">Explain</button>
        <span id="explain-loader" class="loader hidden" aria-hidden="true"></span>
      </div>
    </div>

    <div id="explain-result" class="result-card"></div>
  </div>
</main>

<script>
(() => {
  const API = window.API_BASE || "";
  const tokenKey = "ai_study_token";
  const topicEl = document.getElementById("explain-topic");
  const btn = document.getElementById("explain-btn");
  const loader = document.getElementById("explain-loader");
  const out = document.getElementById("explain-result");

  function show(l){ l.classList.remove("hidden"); }
  function hide(l){ l.classList.add("hidden"); }
  function esc(t){ return String(t||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }

  function explainFormatter(blocks){
    if(!Array.isArray(blocks)) return "<pre>"+esc(JSON.stringify(blocks,null,2))+"</pre>";
    let html = "";
    blocks.forEach(sec=>{
      html += "<div class='explain-block'>";
      if(sec.title) html += "<h3>"+esc(sec.title)+"</h3>";
      if(sec.paragraph) html += "<p>"+esc(sec.paragraph)+"</p>";
      if(sec.bullets && Array.isArray(sec.bullets)){
        html += "<ul>";
        sec.bullets.forEach(b=> html += "<li>"+esc(b)+"</li>");
        html += "</ul>";
      }
      if(sec.examples && Array.isArray(sec.examples)){
        html += "<h4>Examples</h4><ul>";
        sec.examples.forEach(e=> html += "<li>"+esc(e)+"</li>");
        html += "</ul>";
      }
      if(sec.faqs && Array.isArray(sec.faqs)){
        html += "<h4>FAQs</h4>";
        sec.faqs.forEach(f=>{
          html += "<p><strong>Q:</strong> "+esc(f.q)+"</p>";
          html += "<p><strong>A:</strong> "+esc(f.a)+"</p>";
        });
      }
      html += "</div>";
    });
    return html;
  }

  btn.addEventListener("click", async ()=>{
    out.innerHTML = "";
    const topic = (topicEl.value||"").trim();
    if(!topic){ out.innerHTML = "<p style='color:#ff4d6d'>Enter a topic.</p>"; return; }
    show(loader); btn.disabled = true;

    try {
      const headers = { "Content-Type":"application/json" };
      const token = localStorage.getItem(tokenKey);
      if(token) headers["Authorization"] = "Bearer " + token;

      const resp = await fetch((API||"") + "/explain", { method:"POST", headers, body: JSON.stringify({ topic }) });
      const ct = (resp.headers.get("content-type")||"").toLowerCase();
      let data;
      if(ct.includes("json")) data = await resp.json().catch(()=> null);
      else data = { explanation: await resp.text() };

      if(data && data.explanation) {
        out.innerHTML = explainFormatter(data.explanation);
      } else {
        out.innerHTML = "<pre>"+esc(JSON.stringify(data,null,2))+"</pre>";
      }

    } catch (err) {
      out.innerHTML = "<p style='color:#ff4d6d'>Error: "+esc(err.message||err)+"</p>";
    } finally {
      hide(loader); btn.disabled = false;
    }
  });
})();
</script>
</body>
</html>
